{template $appstyle.'common/header'}
{template $appstyle.'common/css'}
			<style type="text/css">
			#APP_Entry {
				/*避免导航边框和列表背景边框重叠，看起来像两条边框似得；*/
				margin-top: -1px;
			}
		</style>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-icon mui-icon-bars mui-pull-left mui-plus-visible"></a>
			<a href="{php echo fm_murl('demo','help','aboutus',array('pagetpl'=>'info'))}"  id="info" class="mui-icon mui-icon-info-filled mui-pull-right" style=" color: rgba(240, 173, 78, 0.91);"></a>
			<h1 class="mui-title">{$shopname}</h1>
		</header>

		<div class="mui-content" style="padding-bottom: 50px;">
			<div class="alert alert-info" style="margin-bottom:1px;font-size: 14px;">
	<button type="button" class="close" data-dismiss="alert">×</button>
	<div>
		<h5> 您好，感谢光临！</h5>
			这是一个测试的预置广告窗口，可关闭！
	</div>

</div>
		    {template $appstyle.'2index/home/index/grid1'}
		    {template $appstyle.'entry/article'}
		    <h5 style="background-color:#efeff4;padding-top: 8px;padding-bottom: 8px;text-indent: 12px;border-top:#fff 3px solid;border-bottom:#fff 3px solid;">
	若干测试链接
	</h5>
			<ul id="APP_Entry" class="mui-table-view mui-table-view-chevron">

				<li class="mui-table-view-cell">
					<a class="mui-navigate-right ShowLanchSplash" href="">
						新用户引导启动屏
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="{php echo fm_murl('demo','2index','home',array('pagetpl'=>'mainpage'))}">
						测试首页
					</a>
				</li>

				<!-- 测试中的新模板 -->
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="{php echo fm_murl('index','home','index',array())}">
						综合版(Home)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="{php echo fm_murl('index','simple','index',array())}">
						极简版(simple)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="{php echo fm_murl('index','site','index',array())}">
						微站版(Site)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="{php echo fm_murl('demo','2index','tpl',array('pagetpl'=>'zujian'))}">
						前端组件
					</a>
				</li>
				<li class="mui-table-view-divider">产品模型演示</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="http://vcms.hiluker.com/app/index.php?c=entry&i=1&m=fm453_shopping&do=goods&ac=detail&op=index&fromplatid=1&lastid=&shareid=8883&share_user=&id=28" >
						默认产品模型(default)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href ="http://vcms.hiluker.com/app/index.php?c=entry&i=1&m=fm453_shopping&do=goods&ac=detail&op=index&fromplatid=1&lastid=&shareid=8883&share_user=&id=26">
						有求必应产品模型(needs)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="http://vcms.hiluker.com/app/index.php?c=entry&i=1&m=fm453_shopping&do=goods&ac=detail&op=index&fromplatid=1&lastid=&shareid=8883&share_user=&id=33">
						接送机/站 产品模型(needs)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="http://vcms.hiluker.com/app/index.php?c=entry&i=1&m=fm453_shopping&do=goods&ac=detail&op=index&fromplatid=1&lastid=&shareid=8883&share_user=&id=32">
						一日游 产品模型(onedaytrip)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="http://vcms.hiluker.com/app/index.php?c=entry&i=1&m=fm453_shopping&do=goods&ac=detail&op=index&fromplatid=1&lastid=&shareid=8883&share_user=&id=31">
						景点门票 产品模型(tickets)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="http://vcms.hiluker.com/app/index.php?c=entry&i=1&m=fm453_shopping&do=goods&ac=detail&op=index&fromplatid=1&lastid=&shareid=8883&share_user=&id=30">
						单酒店套餐 产品模型(hotel)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="http://vcms.hiluker.com/app/index.php?c=entry&i=1&m=fm453_shopping&do=goods&ac=detail&op=index&fromplatid=1&lastid=&shareid=8883&share_user=&id=45">
						酒+X套餐 产品模型(package_hx)
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="http://vcms.hiluker.com/app/index.php?c=entry&i=1&m=fm453_shopping&do=goods&ac=detail&op=index&fromplatid=1&lastid=&shareid=8883&share_user=&id=46">
						水果生鲜 产品模型(fruits)
					</a>
				</li>
				<!-- 原生演示 -->
				<li class="mui-table-view-divider">MUI原生模板</li>
				{loop $pagetpls $key $item}
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="{php echo fm_murl('demo','examples','',array('pagetpl'=>$key))}">
						{$item}
					</a>
				</li>
				{/loop}
			</ul>
		</div>
		<!--底导航栏部分-->
		<footer class="mui-bar mui-bar-footer" style="">
			{template $appstyle.'entry/footerbar'}
		</footer>
		<script src="{$appsrc}/js/mui.min.js"></script>
		<script>
			var aniShow = "pop-in";
			 //只有ios支持的功能需要在Android平台隐藏；
			if (mui.os.android) {
				var list = document.querySelectorAll('.ios-only');
				if (list) {
					for (var i = 0; i < list.length; i++) {
						list[i].style.display = 'none';
					}
				}
				//Android平台暂时使用slide-in-right动画
				if(parseFloat(mui.os.version)<4.4){
					aniShow = "slide-in-right";
				}
			}
			//初始化，并预加载webview模式的选项卡
			function preload () {
				mui.preload({
					url:"{php echo fm_murl('demo','examples','',array('pagetpl'=>'tab-webview-main'))}",
					styles: {
						popGesture: 'hide'
					}
				});
				mui.preload({
					url:"{php echo fm_murl('demo','examples','',array('pagetpl'=>'pullrefresh_main'))}",
					styles:{
						popGesture:'hide'
					}
				});
			}
			var templates = {};
			var getTemplate = function(name, header, content) {
				var template = templates[name];
				if (!template) {
					//预加载共用父模板；
					var headerWebview = mui.preload({
						url: header,
						id: name + "-main",
						styles: {
							popGesture: "hide",
						},
						extras: {
							mType: 'main'
						}
					});
					//预加载共用子webview
					var subWebview = mui.preload({
						url: !content ? "" : content,
						id: name + "-sub",
						styles: {
							top: '45px',
							bottom: '0px',
						},
						extras: {
							mType: 'sub'
						}
					});
					subWebview.addEventListener('titleUpdate', function() {
						setTimeout(function() {
							subWebview.show();
						}, 50);
					});
					subWebview.hide();
					headerWebview.append(subWebview);
					//iOS平台支持侧滑关闭，父窗体侧滑隐藏后，同时需要隐藏子窗体；
					if (mui.os.ios) { //5+父窗体隐藏，子窗体还可以看到？不符合逻辑吧？
						headerWebview.addEventListener('hide', function() {
							subWebview.hide("none");
						});
					}
					templates[name] = template = {
						name: name,
						header: headerWebview,
						content: subWebview,
					};
				}
				return template;
			};
			var initTemplates = function() {
				getTemplate('default', "{php echo fm_murl('demo','examples','',array('pagetpl'=>'template'))}");
			};

			//实机运行时
			mui.plusReady(function() {
				//读取本地存储，检查是否为首次启动
				var showGuide = plus.storage.getItem("lauchFlag");
				if(showGuide){
					//有值，说明已经显示过了，无需显示；
					//关闭splash页面；
					plus.navigator.closeSplashscreen();
					plus.navigator.setFullscreen(false);
					//初始化模板
					initTemplates();
					//预加载
					preload();
				}else{
					//显示启动导航
					mui.openWindow({
						id:'GuidePage',
						url:"{php echo fm_murl('demo','guide','',array('pagetpl'=>''))}",
						show:{
							aniShow:'none'
						},
						waiting:{
							autoShow:false
						}
					});
					//延迟的原因：优先打开启动导航页面，避免资源争夺
					setTimeout(function () {
						//初始化模板
						initTemplates();
						//预加载
						preload();
					},200);
				}
			});
			//手动启动导航
			mui('body').on('tap','a.ShowLanchSplash',function () {
				ShowLanchSplash('true');
			});

			 //主列表点击事件
			mui('body').on('tap', 'a', function() {
				var id = this.getAttribute('href');
				var href = this.href;
				var type = this.getAttribute("open-type");
				//不使用父子模板方案的页面
				if (type == "common") {
					var webview_style = {
						popGesture: "close"
					};
					//侧滑菜单需动态控制一下zindex值；
					if (~id.indexOf('offcanvas-')) {
						webview_style.zindex = 9998;
						webview_style.popGesture = ~id.indexOf('offcanvas-with-right') ? "close" : "none";
					}
					//图标界面需要启动硬件加速
					if(~id.indexOf('icons')){
						webview_style.hardwareAccelerated = true;
					}
					mui.openWindow({
						id: id,
						url: this.href,
						styles: webview_style,
						show: {
							aniShow: aniShow
						},
						waiting: {
							autoShow: false
						}
					});
				} else if (id && ~id.indexOf('')) {
					if (!mui.os.plus || (!~id.indexOf('popovers')&&mui.os.ios)) {
						mui.openWindow({
							id: id,
							url: this.href,
							styles: {
								popGesture: 'close'
							},
							show: {
								aniShow: aniShow
							},
							waiting: {
								autoShow: false
							}
						});
					} else {
						//TODO  by chb 当初这么设计，是为了一个App中有多个模板，目前仅有一个模板的情况下，实际上无需这么复杂
						//使用父子模板方案打开的页面
						//获得共用模板组
						var template = getTemplate('default');
						//判断是否显示右上角menu图标；
						var showMenu = ~href.indexOf('popovers') ? true : false;
						//获得共用父模板
						var headerWebview = template.header;
						//获得共用子webview
						var contentWebview = template.content;
						var title = this.innerText.trim();
						//通知模板修改标题，并显示隐藏右上角图标；
						mui.fire(headerWebview, 'updateHeader', {
							title: title,
							showMenu: showMenu,
							target:href,
							aniShow: aniShow
						});

						if(mui.os.ios||(mui.os.android&&parseFloat(mui.os.version)<4.4)){
							var reload = true;
							if (!template.loaded) {
								if (contentWebview.getURL() != this.href) {
									contentWebview.loadURL(this.href);
								} else {
									reload = false;
								}
							} else {
								reload = false;
							}
							(!reload) && contentWebview.show();

							headerWebview.show(aniShow, 150);
						}
					}
				}
			});
			var index = null; //主页面
			function openMenu() {
				!index && (index = mui.currentWebview.parent());
				mui.fire(index, "menu:open");
			}
			//在android4.4.2中的swipe事件，需要preventDefault一下，否则触发不正常
			window.addEventListener('dragstart', function(e) {
				mui.gestures.touch.lockDirection = true; //锁定方向
				mui.gestures.touch.startDirection = e.detail.direction;
			});
			window.addEventListener('dragright', function(e) {
				if (!mui.isScrolling) {
					e.detail.gesture.preventDefault();
				}
			});
			 //监听右滑事件，若侧滑菜单未显示，右滑要显示菜单；
			window.addEventListener("swiperight", function(e) {
				//默认滑动角度在-45度到45度之间，都会触发右滑菜单，为避免误操作，可自定义限制滑动角度；
				if (Math.abs(e.detail.angle) < 4) {
					openMenu();
				}
			});
		</script>

		<script type="text/javascript">
		//强制调用显示启动屏
		function ShowLanchSplash(yesornot) {
			if (yesornot=='true') {
					//显示启动导航
					mui.openWindow({
						id:'GuidePage',
						url:"{php echo fm_murl('demo','guide','',array('pagetpl'=>''))}",
						show:{
							aniShow:'none'
						},
						waiting:{
							autoShow:false
						}
					});
					//延迟的原因：优先打开启动导航页面，避免资源争夺
					setTimeout(function () {
						//初始化模板
						initTemplates();
						//预加载
						preload();
					},200);
			}
		}
		</script>
{template $appstyle.'common/footer'}